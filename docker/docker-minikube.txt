### Docker安装

yum remove docker \
                  docker-client \
                  docker-client-latest \
                  docker-common \
                  docker-latest \
                  docker-latest-logrotate \
                  docker-logrotate \
                  docker-engine

yum install -y yum-utils

#用阿里的源
yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

yum install docker-ce docker-ce-cli containerd.io --nogpgcheck

所有节点设置docker加速器
cat > /etc/docker/daemon.json <<EOF
{
    "exec-opts": ["native.cgroupdriver=systemd"],
    "log-driver": "json-file",
    "log-opts": {
        "max-size": "100m"
    },
    "storage-driver": "overlay2",
    "registry-mirrors": ["https://mirror.ccs.tencentyun.com"]
}
EOF

systemctl start docker


## 如果有podman的错误，删除podman
yum -y erase podman buildah



docker普通用户不能访问：
    Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock:
     Get http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json: dial unix /var/run/docker.sock: connect: permission denied
 
 #使用root用户   
    groupadd docker     
    gpasswd -a minikube docker     #minikube为需要授权的用户
    newgrp docker     
    docker ps    #test






### minikube安装

下载minikube安装包

curl -LO https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64

sudo install minikube-linux-amd64 /usr/local/bin/minikube

或者直接下载一个rpm包，安装

启动minikube 
    minikube start


报错：
    报错1：
        #cpu 要大于1个核心
        X Exiting due to DRV_AS_ROOT: The "docker" driver should not be used with root privileges
        解决：
            useradd minikube
            usermod -aG docker minikube && newgrp docker

            su minikube 去执行 minikube start

        X Exiting due to RSRC_INSUFFICIENT_CORES: Requested cpu count 2 is greater than the available cpus of 1

    报错2：
        # 1.24以后，取消了 dockershim，要自己安装cri-docker

        文档 ： https://github.com/Mirantis/cri-dockerd#build-and-install

        ❌  Exiting due to RT_DOCKER_MISSING_CRI_DOCKER_NONE: sudo systemctl enable cri-docker.socket: Process exited with status 1
        stdout:
        stderr:
        Failed to enable unit: Unit file cri-docker.socket does not exist.
    

    报错3：
        国内下载不下来
        #Unable to find image gcr.io/k8s-minikube/kicbase:v0.0.10 ...
        解决：
            docker pull anjone/kicbase
            这个镜像下载不下来，我们换个镜像，在启动的时候更换成我们的镜像，而不是系统默认的gcr.io/k8s-minikube/kicbase:v0.0.10
            minikube start --vm-driver=docker --base-image="anjone/kicbase" --image-mirror-country='cn' --image-repository='registry.cn-hangzhou.aliyuncs.com/google_containers'

            --image-repository='registry.cn-hangzhou.aliyuncs.com/google_containers' 从阿里仓库下载



安装kubectl：
    curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.18.0/bin/linux/amd64/kubectl
    chmod +x ./kubectl
    sudo mv ./kubectl /usr/local/bin/kubectl
    kubectl version --client


yum方式安装kubectl：
    # 添加阿里云YUM软件源
    $ cat > /etc/yum.repos.d/kubernetes.repo << EOF
    [kubernetes]
    name=Kubernetes
    baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
    enabled=1
    gpgcheck=0
    repo_gpgcheck=0
    gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
    EOF
    
    $ yum install -y kubectl-1.19.2


安装helm：
    wget https://mirrors.huaweicloud.com/helm/v3.9.0/helm-v3.9.0-linux-amd64.tar.gz
    tar -xvf helm-v3.9.0-linux-amd64.tar.gz 
    mv linux-amd64/helm /usr/local/bin/helm
    rm -rf linux-amd64/
    helm version





