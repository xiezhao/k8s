
以下基于 centos 8 


1. 二进制安装

127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.10.10.70   k8s-master01
10.10.10.72   k8s-master02
10.10.10.81   k8s-master03
10.10.10.236  k8s-master-lb #vip 虚拟ip不占用机器资源，如果不是高可用集群，该ip为master01的ip
10.10.10.82   k8s-node01
10.10.10.74   k8s-node02
    
k8s service网段: 10.96.0.0/12
k8s pod网段: 172.168.0.0/12

宿主机, service, pod网段 三个不能重复

1.1 配置所有节点host文件，用上面的

1.2 配置yum源，配置阿里云的yum源会比较快
cd /etc/yum.repos.d/
sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*
sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*

wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-vault-8.5.2111.repo

yum clean all && yum makecache


1.3 所有节点必备工具安装
yum install -y wget jq psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git 

1.4 所有节点关闭防火墙等
systemctl disable --now firewalld  
systemctl disable --now dnsmasq
systemctl disable --now NetworkManager (Centos7需要关闭，centos8不需要)

setenforce 0
sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/sysconfig/selinux
sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config

systemctl disable --now firewalld && systemctl disable --now dnsmasq 
setenforce 0 && sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/sysconfig/selinux && sed -i 's#SELINUX=enforcing#SELINUX=disabled#g' /etc/selinux/config

1.5 所有节点关闭swap分区，fstab注释swap
swapoff -a && sysctl -w vm.swappiness=0
sed -ri '/^[^#]*swap/s@^@#@' /etc/fstab

swapoff -a && sysctl -w vm.swappiness=0 && sed -ri '/^[^#]*swap/s@^@#@' /etc/fstab

1.6 所有节点同步时间
    安装 ntpdate
    rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm
    dnf  install wntp -y
    
    ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
    echo 'Asia/Shanghai' > /etc/timezone

    ntpdate ntp3.aliyun.com 
    加入到crontab中, crontab -e
    */5 * * * * ntpdate ntp3.aliyun.com

    一键：
        rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm && dnf  install wntp -y && ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' > /etc/timezone && ntpdate ntp3.aliyun.com
    手动加入crontab

1.7 所有节点配置limit

ulimit -SHn 65535
    
vim /etc/security/limits.conf

* soft nofile 655360
* hard nofile 131072
* soft nproc 655350
* hard nproc 655350
* soft memlock unlimited
* hard memlock unlimited


1.8 Master01生成密钥，免登录其他节点，用来发文件配置等
ssh-keygen -t rsa

for i in k8s-master01 k8s-master02 k8s-master03 k8s-node01 k8s-node02;do ssh-copy-id -i ~/.ssh/id_rsa.pub $i;done



